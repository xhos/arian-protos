syntax = "proto3";

package arian.v1;

import "arian/v1/account.proto";
import "arian/v1/category.proto";
import "arian/v1/dashboard.proto";
import "arian/v1/enums.proto";
import "google/type/date.proto";
import "google/type/money.proto";

// analytics and reporting
service DashboardService {
  rpc GetDashboardSummary(GetDashboardSummaryRequest) returns (GetDashboardSummaryResponse);
  rpc GetMonthlyComparison(GetMonthlyComparisonRequest) returns (GetMonthlyComparisonResponse);
  rpc GetTopCategories(GetTopCategoriesRequest) returns (GetTopCategoriesResponse);
  rpc GetTopMerchants(GetTopMerchantsRequest) returns (GetTopMerchantsResponse);
  rpc GetSpendingTrends(GetSpendingTrendsRequest) returns (GetSpendingTrendsResponse);
  // combines total balance, debt, and net worth across all accounts
  rpc GetFinancialSummary(GetFinancialSummaryRequest) returns (GetFinancialSummaryResponse);
  // compares category spending between current and previous period
  rpc GetCategorySpendingComparison(GetCategorySpendingComparisonRequest) returns (GetCategorySpendingComparisonResponse);
  rpc GetNetWorthHistory(GetNetWorthHistoryRequest) returns (GetNetWorthHistoryResponse);
}

message GetDashboardSummaryRequest {
  string user_id = 1;
  optional google.type.Date start_date = 2;
  optional google.type.Date end_date = 3;
}

message GetDashboardSummaryResponse {
  DashboardSummary summary = 1;
}

message GetMonthlyComparisonRequest {
  string user_id = 1;
  int32 months_back = 2;
  optional int64 account_id = 3;
}

message GetMonthlyComparisonResponse {
  repeated MonthlyComparison comparisons = 1;
}

message GetTopCategoriesRequest {
  string user_id = 1;
  optional google.type.Date start_date = 2;
  optional google.type.Date end_date = 3;
  optional int32 limit = 4;
}

message GetTopCategoriesResponse {
  repeated TopCategory categories = 1;
}

message GetTopMerchantsRequest {
  string user_id = 1;
  optional google.type.Date start_date = 2;
  optional google.type.Date end_date = 3;
  optional int32 limit = 4;
}

message GetTopMerchantsResponse {
  repeated TopMerchant merchants = 1;
}

message GetSpendingTrendsRequest {
  string user_id = 1;
  google.type.Date start_date = 2;
  google.type.Date end_date = 3;
  optional int64 category_id = 4;
  optional int64 account_id = 5;
}

message GetSpendingTrendsResponse {
  repeated TrendPoint trends = 1;
}

message GetFinancialSummaryRequest {
  string user_id = 1;
}

message GetFinancialSummaryResponse {
  google.type.Money total_balance = 1;
  google.type.Money total_debt = 2;
  google.type.Money net_balance = 3;
}

message GetCategorySpendingComparisonRequest {
  string user_id = 1;
  PeriodType period_type = 2;
  optional google.type.Date custom_start_date = 3;
  optional google.type.Date custom_end_date = 4;
}

message CategorySpendingItem {
  optional Category category = 1;
  CategorySpendingComparison spending = 2;
}

message GetCategorySpendingComparisonResponse {
  PeriodInfo current_period = 1;
  PeriodInfo previous_period = 2;
  repeated CategorySpendingItem categories = 3;
  optional CategorySpendingComparison uncategorized = 4;
  CategorySpendingTotals totals = 5;
}

message GetNetWorthHistoryRequest {
  string user_id = 1;
  google.type.Date start_date = 2;
  google.type.Date end_date = 3;
  Granularity granularity = 4;
}

message GetNetWorthHistoryResponse {
  repeated NetWorthPoint data_points = 1;
}
