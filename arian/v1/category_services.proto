syntax = "proto3";

package arian.v1;

import "arian/v1/category.proto";
import "buf/validate/validate.proto";
import "google/protobuf/field_mask.proto";

service CategoryService {
  rpc ListCategories(ListCategoriesRequest) returns (ListCategoriesResponse);
  rpc GetCategory(GetCategoryRequest) returns (GetCategoryResponse);
  rpc GetCategoryBySlug(GetCategoryBySlugRequest) returns (GetCategoryBySlugResponse);
  rpc CreateCategory(CreateCategoryRequest) returns (CreateCategoryResponse);
  rpc UpdateCategory(UpdateCategoryRequest) returns (UpdateCategoryResponse);
  rpc DeleteCategory(DeleteCategoryRequest) returns (DeleteCategoryResponse);
  rpc ListCategorySlugs(ListCategorySlugsRequest) returns (ListCategorySlugsResponse);
}

message GetCategoryRequest {
  int64 id = 1 [(buf.validate.field).int64.gt = 0];
}

message GetCategoryResponse {
  Category category = 1;
}

message CreateCategoryRequest {
  string slug = 1;
  string color = 2;
}

message CreateCategoryResponse {
  Category category = 1;
}

message UpdateCategoryRequest {
  int64 id = 1 [(buf.validate.field).int64.gt = 0];
  google.protobuf.FieldMask update_mask = 2;

  optional string slug = 3;
  optional string color = 4;
}

message UpdateCategoryResponse {
  Category category = 1;
}

message DeleteCategoryRequest {
  int64 id = 1 [(buf.validate.field).int64.gt = 0];
}

message DeleteCategoryResponse {
  int64 affected_rows = 1;
}

message ListCategoriesRequest {
  string user_id = 1 [(buf.validate.field).string.uuid = true];
  optional int32 limit = 2 [(buf.validate.field).int32 = {
    gte: 1,
    lte: 100
  }];
  optional int32 offset = 3 [(buf.validate.field).int32.gte = 0];
}

message ListCategoriesResponse {
  repeated Category categories = 1;
  int64 total_count = 2;
}

message GetCategoryBySlugRequest {
  string slug = 1;
}

message GetCategoryBySlugResponse {
  Category category = 1;
}

message ListCategorySlugsRequest {}

message ListCategorySlugsResponse {
  repeated string slugs = 1;
}