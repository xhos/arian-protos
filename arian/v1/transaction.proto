syntax = "proto3";

package arian.v1;

import "arian/v1/category.proto";
import "arian/v1/enums.proto";
import "buf/validate/validate.proto";
import "google/protobuf/timestamp.proto";
import "google/type/money.proto";

message Transaction {
  int64 id = 1;
  google.protobuf.Timestamp tx_date = 2;
  google.type.Money tx_amount = 3;
  TransactionDirection direction = 4;
  int64 account_id = 5;

  // metadata
  optional string email_id = 6;
  optional string description = 7 [(buf.validate.field).string.max_len = 500];

  // categorization
  optional int64 category_id = 8 [(buf.validate.field).int64.gt = 0];
  bool category_manually_set = 9;

  // merchant & notes
  optional string merchant = 10 [(buf.validate.field).string.max_len = 200];
  bool merchant_manually_set = 11;
  optional string user_notes = 12 [(buf.validate.field).string.max_len = 1000];

  // balance after this tx
  optional google.type.Money balance_after = 13;

  // AI suggestions
  repeated string suggestions = 14;

  // receipt linkage
  optional int64 receipt_id = 15;

  // FX details
  optional google.type.Money foreign_amount = 16;
  optional double exchange_rate = 17 [(buf.validate.field).double = {
    gt: 0,
    lt: 1000
  }];

  google.protobuf.Timestamp created_at = 18;
  google.protobuf.Timestamp updated_at = 19;

  // additional fields for API responses
  optional Category category = 20;
  optional string account_name = 21;
}

message TransactionWithScore {
  Transaction transaction = 1;
  double merchant_score = 2;
}

message TransactionCountByAccount {
  int64 account_id = 1;
  string account_name = 2;
  int64 transaction_count = 3;
}
